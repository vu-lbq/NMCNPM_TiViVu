---
config:
  theme: default
  layout: elk
---
flowchart LR
  %% Use Case Diagram approximation (Mermaid lacks native use case support)
  %% Actors
  User((Learner))
  Admin((Admin))
  STT((STT Provider))
  TTS((TTS Provider))
  LLM((LLM Service))
  Dict((Dictionary Service))
  Trans((Translation Service))
  Mail((Mail Service))

  %% System boundary
  subgraph System[English Learning App]
    Register([Register])
    Login([Login])
    Logout([Logout])
    ForgotPassword([Forgot Password])
    ResetPassword([Reset Password])

    AuthSession([Authenticated Session])

    ManageProfile([Manage Profile])
    StartConversation([Start Conversation])
    CaptureVoice([Capture Voice])
    STTTranscription([STT Transcription])
    EditTranscription([Edit Transcription])
    SendMessage([Send Message])
    GetLLMResponse([Get LLM Response])
    SuggestNextQuestions([Suggest Next Questions])
    PlayResponse([Play Response])
    TTSSynthesis([TTS Synthesis])

    TapWord([Tap Word])
    GetDefinition([Get Definition/Pronunciation])
    TranslateText([Translate Text])
    SaveWord([Save Word])
    ReviewVocabulary([Review Vocabulary])
    ViewHistory([View Conversation History])
    Settings([Settings])
    Feedback([Feedback / Report Issue])

    ManagePrompts([Manage Prompts/Templates])
    MonitorUsage([Monitor Usage/Analytics])
    ManageUsers([Manage Users])
    ManageContent([Manage Content/Glossary])
  end

  %% Actor associations
  User --> Register
  User --> Login
  User --> Logout
  User --> ForgotPassword
  User --> ResetPassword
  User --> ManageProfile
  User --> StartConversation
  User --> CaptureVoice
  User --> EditTranscription
  User --> SendMessage
  User --> PlayResponse
  User --> TapWord
  User --> TranslateText
  User --> SaveWord
  User --> ReviewVocabulary
  User --> ViewHistory
  User --> Settings
  User --> Feedback

  Admin --> ManagePrompts
  Admin --> MonitorUsage
  Admin --> ManageUsers
  Admin --> ManageContent

  %% External service associations (treated as actors)
  STT --> STTTranscription
  TTS --> TTSSynthesis
  LLM --> GetLLMResponse
  Dict --> GetDefinition
  Trans --> TranslateText
  Mail --> ForgotPassword
  Mail --> ResetPassword

  %% Include relationships
  %% Auth gating: protected features require Authenticated Session, which includes Login
  AuthSession -->|include| Login
  ManageProfile -->|include| AuthSession
  StartConversation -->|include| AuthSession
  CaptureVoice -->|include| AuthSession
  STTTranscription -->|include| AuthSession
  EditTranscription -->|include| AuthSession
  SendMessage -->|include| AuthSession
  GetLLMResponse -->|include| AuthSession
  SuggestNextQuestions -->|include| AuthSession
  PlayResponse -->|include| AuthSession
  TTSSynthesis -->|include| AuthSession
  TapWord -->|include| AuthSession
  GetDefinition -->|include| AuthSession
  TranslateText -->|include| AuthSession
  SaveWord -->|include| AuthSession
  ReviewVocabulary -->|include| AuthSession
  ViewHistory -->|include| AuthSession
  Settings -->|include| AuthSession
  Feedback -->|include| AuthSession
  ManagePrompts -->|include| AuthSession
  MonitorUsage -->|include| AuthSession
  ManageUsers -->|include| AuthSession
  ManageContent -->|include| AuthSession
  StartConversation -->|include| CaptureVoice
  CaptureVoice -->|include| STTTranscription
  SendMessage -->|include| GetLLMResponse
  GetLLMResponse -->|include| SuggestNextQuestions
  PlayResponse -->|include| TTSSynthesis
  TapWord -->|include| GetDefinition
  ReviewVocabulary -->|include| SaveWord

  %% Extend relationships
  EditTranscription -.->|extend| STTTranscription
  TapWord -.->|extend| TranslateText
  SaveWord -.->|extend| TapWord
  Login -.->|extend| Register
  Logout -.->|extend| Login
  ForgotPassword -.->|extend| Login
  ResetPassword -.->|extend| ForgotPassword

  %% Notes
  %% Latency targets: STT 1-2s, LLM 2-4s, TTS 1-2s
  %% Fallbacks: manual text input if STT fails; text display if TTS fails